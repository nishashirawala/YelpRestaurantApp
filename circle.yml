machine:
    environment:
      ADB_INSTALL_TIMEOUT=10

dependencies:
     override:
         - chmod +x gradlew
     pre:
          - echo y | android update sdk --no-ui --all --filter tools,platform-tools,extra-google-m2repository,extra-google-google_play_services,extra-android-support,android-21
          - echo y | android update sdk --no-ui --all --filter build-tools-23.0.3

     cache_directories:
          - /usr/local/android-sdk-linux/tools
          - /usr/local/android-sdk-linux/build-tools/23.0.3

test:
    override:
        - ./gradlew clean assembleDebug -PdisablePreDex
        - ./gradlew test -PdisablePreDex
        - emulator -avd circleci-android21 -no-skin -no-audio -no-window:
             background: true
             parallel: true
        # wait for it to have booted
        - circle-android wait-for-boot
        - adb shell input keyevent 82
        # run tests  against the emulator.
        -  ./gradlew connectedAndroidTest --stacktrace --info
            timeout: 360